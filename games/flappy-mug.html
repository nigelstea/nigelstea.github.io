<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Nigel's Tea - Flappy Mug</title>
    <link rel="icon" href="../logo.png" type="image/png">
    <style>
        /* [Your existing CSS code remains unchanged] */
        /* ... */
    </style>
</head>
<body>

    <!-- Navigation Bar -->
    <div class="navbar">
        <!-- [Your existing navigation bar code remains unchanged] -->
        <!-- ... -->
    </div>

    <!-- Game Container -->
    <div id="game-container">
        <canvas id="gameCanvas" width="480" height="640"></canvas>
        <!-- Start Screen -->
        <div id="start-screen">
            <h1>Flappy Mug</h1>
            <button onclick="startGame()">Play</button>
        </div>
        <!-- Game Over Screen -->
        <div id="game-over">
            <p>Game Over</p>
            <p>Your Score: <span id="final-score">0</span></p>
            <button onclick="restartGame()">Play Again</button>
        </div>
    </div>

    <!-- Game Script -->
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Mug Emoji
        const mugEmoji = 'â˜•';
        const mugSize = 40;
        let mugX = canvas.width / 4;
        let mugY = canvas.height / 2;
        let mugVelocity = 0;
        const gravity = 0.2;
        const jumpStrength = -6;

        // Pipes
        let pipes = [];
        const pipeWidth = 60;
        const pipeGap = 200;
        const pipeVelocity = 1.5;
        let pipeSpawnTimer = 0;
        const pipeSpawnInterval = 100; // frames

        // Score
        let score = 0;
        let gameOver = false;
        let gameStarted = false; // Track if the game has started

        // Game Screens
        const startScreen = document.getElementById('start-screen');
        const gameOverScreen = document.getElementById('game-over');
        const finalScore = document.getElementById('final-score');

        // Event Listeners
        document.addEventListener('keydown', handleKeyDown);
        canvas.addEventListener('mousedown', handleKeyDown); // For mouse clicks/taps

        // Start Game Function
        function startGame() {
            gameStarted = true;
            startScreen.style.display = 'none';
            animate();
        }

        // Restart Game Function
        function restartGame() {
            // Reset game variables
            mugX = canvas.width / 4;
            mugY = canvas.height / 2;
            mugVelocity = 0;
            pipes = [];
            pipeSpawnTimer = 0;
            score = 0;
            gameOver = false;
            gameOverScreen.style.display = 'none';
            startGame();
        }

        // Handle Key Down
        function handleKeyDown(e) {
            if (e.code === 'Space' || e.type === 'mousedown') {
                mugVelocity = jumpStrength;
            }
        }

        // Collision Detection
        function checkCollision(pipe) {
            // Mug rectangle
            const mugRect = {
                x: mugX,
                y: mugY,
                width: mugSize,
                height: mugSize
            };

            // Top pipe rectangle
            const topPipeRect = {
                x: pipe.x,
                y: 0,
                width: pipeWidth,
                height: pipe.top
            };

            // Bottom pipe rectangle
            const bottomPipeRect = {
                x: pipe.x,
                y: pipe.top + pipeGap,
                width: pipeWidth,
                height: canvas.height - (pipe.top + pipeGap)
            };

            // Check for collision with top pipe
            if (rectIntersect(mugRect, topPipeRect)) {
                return true;
            }

            // Check for collision with bottom pipe
            if (rectIntersect(mugRect, bottomPipeRect)) {
                return true;
            }

            // Check for collision with ground or ceiling
            if (mugY <= 0 || mugY + mugSize >= canvas.height) {
                return true;
            }

            return false;
        }

        // Rectangle Intersection Helper
        function rectIntersect(rect1, rect2) {
            return !(rect2.x > rect1.x + rect1.width ||
                     rect2.x + rect2.width < rect1.x ||
                     rect2.y > rect1.y + rect1.height ||
                     rect2.y + rect2.height < rect1.y);
        }

        // Game Loop
        function animate() {
            if (!gameStarted || gameOver) return;

            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Mug physics
            mugVelocity += gravity;
            mugY += mugVelocity;

            // Draw Mug
            ctx.font = `${mugSize}px Arial`;
            ctx.fillText(mugEmoji, mugX, mugY);

            // Handle Pipes
            pipeSpawnTimer++;
            if (pipeSpawnTimer >= pipeSpawnInterval) {
                const pipeTopHeight = Math.random() * (canvas.height / 2);
                pipes.push({
                    x: canvas.width,
                    top: pipeTopHeight
                });
                pipeSpawnTimer = 0;
            }

            // Move and draw pipes
            for (let i = pipes.length - 1; i >= 0; i--) {
                pipes[i].x -= pipeVelocity;

                // Draw top pipe
                ctx.fillStyle = '#8B4513';
                ctx.fillRect(pipes[i].x, 0, pipeWidth, pipes[i].top);

                // Draw bottom pipe
                ctx.fillRect(pipes[i].x, pipes[i].top + pipeGap, pipeWidth, canvas.height - pipes[i].top - pipeGap);

                // Check for collision
                if (checkCollision(pipes[i])) {
                    gameOver = true;
                    finalScore.textContent = score;
                    gameOverScreen.style.display = 'block';
                }

                // Increase score and remove off-screen pipes
                if (pipes[i].x + pipeWidth < 0) {
                    pipes.splice(i, 1);
                    score++;
                }
            }

            // Display score
            ctx.fillStyle = '#000';
            ctx.font = '24px Arial';
            ctx.fillText(`Score: ${score}`, 10, 30);

            requestAnimationFrame(animate);
        }
    </script>
</body>
</html>
